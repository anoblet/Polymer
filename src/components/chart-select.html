<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../lib/map-property/map-property.html">
<link rel="import" href="app-data.html">

<dom-module id="chart-select">
    <template>
        <paper-dropdown-menu label="Chart" selected-item-label="{{chart}}">
            <paper-listbox slot="dropdown-content" selected="{{index}}">
                <template is="dom-repeat" items="[[charts]]">
                    <paper-item>[[item]]</paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
        <app-data data="{{data}}"></app-data>
        <map-property source="{{data.configuration.primaryColor}}" target="{{primaryColor}}"></map-property>
    </template>
    <script>
        class ChartSelect extends Polymer.Element {
            static get is() {
                return 'chart-select';
            }

            static get properties() {
                return {
                    chart: {
                        type: String,
                        value: 'column',
                        observer: '_chartChanged',
                        notify: true
                    },
                    index: {
                        type: Number,
                        value: 4
                    },
                    charts: {
                        type: Array,
                        value: function() {
                            return [
                                'area',
                                'bar',
                                'bubble',
                                'candlestick',
                                'column',
                                'geo',
                                'pie',
                                'table'
                            ]
                        }
                    },
                    options: {
                        type: Object,
                        notify: true
                    },
                    primaryColor: {
                        type: String
                    }
                }
            }

            constructor() {
                super();
                this._boundListener = this._styleChanged.bind(this);
            }

            _chartChanged(chart) {
                this.options = {
                    chartArea: {
                        width: '80%',
                        height: '80%'
                    },
                    // colors: [this.primaryColor],
                    legend: {
                        alignment: 'center',
                        position: 'top',
                    }
                };
                if (chart == "geo") {
                    this.options.region = "US";
                    this.options.resolution = "provinces";
                    this.options.defaultColor= '#90caf9'
                }
            }

            _styleChanged(e) {
                console.log("Here");
                (function () { console.log(new Error().stack); })();
                console.log(e)
            }

            connectedCallback() {
                super.connectedCallback();
                window.addEventListener('styleChanged', this._boundListener);
            }

            disconnectedCallback() {
                super.disconnectedCallback();
                window.removeEventListener('styleChanged', this._boundListener);
            }

        }
        window.customElements.define(ChartSelect.is, ChartSelect);
    </script>
</dom-module>
