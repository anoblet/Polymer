<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-meta/iron-meta.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/map-property/map-property.html">
<link rel="import" href="../../bower_components/my-singleton/my-singleton.html">
<link rel="import" href="../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="HelperMixin.html">

<dom-module id="chart-select">
    <template>
        <my-singleton property="styles" value="{{styles}}"></my-singleton>
        <paper-dropdown-menu label="Chart" selected-item-label="{{chart}}">
            <paper-listbox slot="dropdown-content" selected="{{index}}">
                <template is="dom-repeat" items="[[charts]]">
                    <paper-item>[[item]]</paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
    </template>
    <script>
        class ChartSelect extends Polymer.MutableData(HelperMixin(Polymer.Element)) {
            static get is() {
                return 'chart-select';
            }

            static get properties() {
                return {
                    chart: {
                        type: String,
                        value: 'column',
                        observer: '_chartChanged',
                        notify: true
                    },
                    index: {
                        type: Number,
                        value: 4
                    },
                    charts: {
                        type: Array,
                        value: function () {
                            return [
                                'area',
                                'bar',
                                'bubble',
                                'candlestick',
                                'column',
                                'geo',
                                'pie',
                                'table'
                            ]
                        }
                    },
                    options: {
                        type: Object,
                        notify: true
                    },
                    primaryColor: {
                        type: String
                    },
                    styles: {
                        type: Object
                        // observer: '_stylesChanged'
                    },
                    stylesTest: {
                        type: Object,
                        computed: '_stringify(styles)'
                    }
                }
            }

            static get observers() {
                return [
                    '_stylesChanged(styles.*)'
                ]
            }

            constructor() {
                super();
                // this._boundListener = this._styleChanged.bind(this);
            }

            _chartChanged(chart) {
                console.log(this.styles);
                this.options = {
                    chartArea: {
                        width: '80%',
                        height: '80%'
                    },
                    legend: {
                        alignment: 'center',
                        position: 'top',
                    }
                };
                if(chart == "geo") {
                    this.options.region = "US";
                    this.options.resolution = "provinces";
                    this.options.defaultColor = '#90caf9'
                }

                // if(this.styles) {
                    this.options.colors = [this.styles.primaryColor]
                // }
            }

            _styleChanged(e) {
                console.log("Here");
                (function () {
                    console.log(new Error().stack);
                })();
                console.log(e)
            }

            connectedCallback() {
                super.connectedCallback();
                console.log(this.styles);
                // this.set("options.colors", [this.styles.primaryColor]),
                // window.addEventListener('styleChanged', this._boundListener);
            }

            disconnectedCallback() {
                super.disconnectedCallback();
                // window.removeEventListener('styleChanged', this._boundListener);
            }

            _stylesChanged(styles) {
                console.log("Here");
                this.set("options.colors", [this.styles.primaryColor]);
            }

        }

        window.customElements.define(ChartSelect.is, ChartSelect);
    </script>
</dom-module>
