<script>
    (function () {

        let subscribers = [];
        let user = {"test": "test"};
        let isRoot = false;

        UserMixin = function (superClass) {
            return class extends superClass {
                static get properties() {
                    return {
                        subscribers: {
                            type: Object,
                        },
                        user: {
                            type: Object,
                            notify: true
                        },
                        isRoot: {
                            type: Boolean,
                            value: isRoot
                        }
                    }
                }

                static get observers() {
                    return [
                        'dataChanged(data.*)',
                    ]
                }

                dataChanged(change) {
                    // Only let one instance update all of the others
                    if (!isRoot) {
                        isRoot = true;
                        if (this.subscribers) {
                            this.subscribers.forEach(e => {
                                e.notifyPath(change.path);
                            });
                        }
                        isRoot = false;
                    }
                }

                connectedCallback() {
                    super.connectedCallback();

                    this.subscribers = subscribers;
                    this.subscribers.push(this);
                    // Set the user property
                    this.user = user;
                }

                disconnectedCallback() {
                    super.disconnectedCallback();

                    var index = this.subscribers.indexOf(this);
                    if (index > -1) this.subscribers.splice(index, 1)
                }
            }
        }
    })();
</script>