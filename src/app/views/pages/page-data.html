<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../components/google-chart-responsive/google-chart-responsive.html">
<link rel="import" href="../../../components/fact-finder/fact-finder.html">
<!--<link rel="import" href="../../../components/fact-finder/fact-finder-adapter.html">-->
<link rel="import" href="../../../components/fact-finder/fact-finder-tables.html">
<link rel="import" href="../../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../bower_components/neon-animation/web-animations.html">

<dom-module id="page-data">
    <template>
        <style>
            :host {
                width: 100%;
            }
        </style>
        <paper-input label="Geography ID" value="{{geographyId}}"></paper-input>
        <paper-dropdown-menu label="Table" selected-item-label="{{table}}">
            <paper-listbox slot="dropdown-content">
                <template is="dom-repeat" items="[[tables]]">
                    <paper-item>[[item]]</paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
        <paper-dropdown-menu label="Chart Type" selected-item-label="{{chartType}}">
            <paper-listbox slot="dropdown-content">
                <template is="dom-repeat" items="[[chartTypes]]">
                    <paper-item>[[item]]</paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
        <my-grid>
            <my-card>
                <div class="card-content">
                    <google-chart-responsive type="[[chartType]]" options="[[options]]" data="[[chartData]]"></google-chart-responsive>
                </div>
            </my-card>
        </my-grid>
        <fact-finder program="DEC" _dataset="10_SF1" table="[[table]]" geography-id="[[geographyId]]" key="c97423c3f598951d2138d69861730b9154cd7230" response="{{response}}"></fact-finder>
        <fact-finder-tables tables="{{tables}}"></fact-finder-tables>
        <!--<fact-finder-adapter input="[[response]]" output="{{data}}"></fact-finder-adapter>-->
    </template>
    <script>
        class PageData extends Polymer.Element {
            static get is() {
                return 'page-data';
            }

            static get properties() {
                return {
                    chartData: {
                        type: Array,
                        // computed: '_chartData(data)'
                    },
                    chartTypes: {
                        type: Array,
                        value: function() {
                            return [
                                "bar",
                                "pie",
                                "table"
                            ]
                        }
                    },
                    geographyId: {
                        type: String,
                        value: "0100000US"
                    },
                    response: {
                        type: Object,
                        observer: '_responseChanged'
                    }
                }
            }

            _responseChanged(response) {
                console.log(response);
                if(response.data);
                else {
                    return;
                }
                let headerCells = response.data.header.cells;
                let rows = response.data.rows;
                let headers = [];

                let newData = [];
                let newRow = [];
                newRow.push("Location");
                for (let header in headerCells) {
                    let categories = headerCells[header].categories;
                    for (let category in categories) {
                        newRow.push(categories[category].label);
                    }
                }
                newData.push(newRow);

                for (let row in rows) {
                    let newDataRow = []
                    let newRow = rows[row];
                    newDataRow.push(newRow.categories.GEO.label);
                    for (let cell in newRow.cells) {
                        let newCell = newRow.cells[cell];
                        newDataRow.push(newCell.value);
                    }
                    newData.push(newDataRow);
                }

                // newData.push(headers);
                // newData.push(data);

                console.log(newData);

                this.chartData = newData;
            }
        }

        window.customElements.define(PageData.is, PageData);
    </script>
</dom-module>
